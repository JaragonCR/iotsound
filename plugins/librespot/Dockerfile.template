FROM golang:1.22-alpine

RUN apk add --no-cache \
    git \
    build-base \
    pkgconf \
    alsa-lib-dev \
    libogg-dev \
    libvorbis-dev

RUN git clone https://github.com/devgianlu/go-librespot.git /go-librespot

WORKDIR /go-librespot

RUN go build -v ./cmd/daemon
ENV PULSE_SERVER=tcp:localhost:4317
COPY start.sh /usr/src/

CMD [ "/bin/sh", "/usr/src/start.sh" ]
